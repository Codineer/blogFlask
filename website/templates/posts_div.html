{% extends 'base.html' %}

{% block content %}
<h1 class="text-4xl px-4 pt-4 flex justify-between">
    {% block header %}

    {% endblock %}
</h1>
{% block posts %}
<section class="text-gray-600 body-font overflow-hidden ">
    <div class="container px-5 py-24 mx-auto">
        <div class="-my-8 divide-y-2 divide-gray-100 ">
            {% for post in posts %}

            <div class="py-8 flex flex-wrap md:flex-nowrap bg-slate-100 p-4 flex-col md:flex-row rounded-sm relative ">
                <div class="absolute top-3 right-3 flex gap-2">

                    {% if user.id == post.author %}
                    <div class=" cursor-pointer" onclick="delete_post('{{post.id}}')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="red" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6l1 12a2 2 0 002 2h12a2 2 0 002-2l1-12M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2">
                            </path>
                        </svg>
                    </div>
                    {% endif %}
                    {% if user.id in post.likes|map(attribute="author")|list %}
                    {% set icon_color="red" %}
                    {% else %}
                    {% set icon_color="black" %}
                    {% endif %}


                    <div class=" cursor-pointer" onclick="like_post('{{post.id}}')">

                        <svg id="likebutton{{post.id}}" xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink" fill="{{icon_color}}" height="20" width="20"
                            version="1.1" viewBox="0 0 512 512" xml:space="preserve">
                            <g>
                                <path
                                    d="M498.323,297.032c0-7.992-1.901-15.683-5.553-22.635c12.034-9.18,19.23-23.438,19.23-38.914   c0-27.037-21.996-49.032-49.032-49.032H330.206c11.434-29.24,17.665-64.728,17.665-101.419c0-23.266-18.928-42.194-42.194-42.194   s-42.193,18.928-42.193,42.194c0,83.161-58.012,145.389-144.355,154.844c-0.592,0.065-1.159,0.197-1.7,0.38   C111.752,235.129,104.235,232,96,232H32c-17.645,0-32,14.355-32,32v152c0,17.645,14.355,32,32,32h64   c9.763,0,18.513-4.4,24.388-11.315c20.473,2.987,33.744,9.534,46.568,15.882c16.484,8.158,33.53,16.595,63.496,16.595h191.484   c27.037,0,49.032-21.996,49.032-49.032c0-7.991-1.901-15.683-5.553-22.635c12.034-9.18,19.23-23.438,19.23-38.914   c0-7.991-1.901-15.683-5.553-22.635C491.126,326.766,498.323,312.507,498.323,297.032z M465.561,325.727H452c-4.418,0-8,3.582-8,8   s3.582,8,8,8h11.958c3.061,5.1,4.687,10.847,4.687,16.854c0,12.106-6.56,23.096-17.163,28.919h-14.548c-4.418,0-8,3.582-8,8   s3.582,8,8,8h13.481c2.973,5.044,4.553,10.71,4.553,16.629c0,18.214-14.818,33.032-33.032,33.032H230.452   c-26.223,0-40.207-6.921-56.398-14.935c-12.358-6.117-26.235-12.961-46.56-16.594c0.326-1.83,0.506-3.71,0.506-5.632V295   c0-4.418-3.582-8-8-8s-8,3.582-8,8v121c0,8.822-7.178,16-16,16H32c-8.822,0-16-7.178-16-16V264c0-8.822,7.178-16,16-16h64   c8.822,0,16,7.178,16,16c0,4.418,3.582,8,8,8s8-3.582,8-8c0-3.105-0.453-6.105-1.282-8.947   c44.778-6.106,82.817-25.325,110.284-55.813c27.395-30.408,42.481-70.967,42.481-114.208c0-14.443,11.75-26.194,26.193-26.194   c14.443,0,26.194,11.75,26.194,26.194c0,39.305-7.464,76.964-21.018,106.04c-1.867,4.004-0.134,8.764,3.871,10.631   c1.304,0.608,2.687,0.828,4.025,0.719c0.201,0.015,0.401,0.031,0.605,0.031h143.613c18.214,0,33.032,14.818,33.032,33.032   c0,11.798-6.228,22.539-16.359,28.469h-14.975c-4.418,0-8,3.582-8,8s3.582,8,8,8h12.835c3.149,5.155,4.822,10.984,4.822,17.079   C482.323,308.985,475.927,319.848,465.561,325.727z" />
                                <path
                                    d="M422.384,325.727h-8.525c-4.418,0-8,3.582-8,8s3.582,8,8,8h8.525c4.418,0,8-3.582,8-8S426.802,325.727,422.384,325.727z" />
                                <path
                                    d="M436.934,263.953h-8.525c-4.418,0-8,3.582-8,8s3.582,8,8,8h8.525c4.418,0,8-3.582,8-8S441.352,263.953,436.934,263.953z" />
                                <path
                                    d="M407.833,387.5h-8.525c-4.418,0-8,3.582-8,8s3.582,8,8,8h8.525c4.418,0,8-3.582,8-8S412.252,387.5,407.833,387.5z" />
                                <path
                                    d="M80,264c-8.822,0-16,7.178-16,16s7.178,16,16,16s16-7.178,16-16S88.822,264,80,264z" />
                            </g>
                        </svg>

                    </div>

                </div>
                <div class="md:w-64 md:mb-0 mb-6 flex-shrink-0 flex flex-col">
                    <span class="font-semibold title-font text-gray-700">Blog</span>
                    <span class="mt-1 text-gray-500 text-sm">{{ post.date_created.strftime('%d %B,%Y')
                        }} &ensp; {{post.likes | length}} likes</span>
                </div>
                <div class="md:flex-grow">
                    <h2 class="text-2xl font-medium text-gray-900 title-font mb-2">{{post.topic}}</h2>
                    <p class="leading-relaxed">{{post.message}}</p>
                    <a class="text-indigo-500 inline-flex items-center mt-4"
                        href="/posts/{{post.user.username}}">{{post.user.username}}
                        <svg class="w-4 h-4 ml-2" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12h14"></path>
                            <path d="M12 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>

            </div>
            <div class="bg-slate-100 mb-10 p-4 flex-col flex gap-2">
                <form class="input-group mb-3" onsubmit="handleCommentSubmit(event,'{{post.id}}')">
                    <div class="w-full">
                        <label for="small-input" class="block mb-2 text-sm font-medium text-black ">
                            Add Comment</label>
                        <div class="w-full">

                            <input type="text" id="small-input" name="text"
                                class="block  p-2 border-black border w-full mb-2">
                            <button type="submit"
                                class=" px-3 py-3 font-sans text-xs font-bold text-center text-gray-900 uppercase align-middle transition-all rounded-lg select-none hover:bg-gray-900/10 active:bg-gray-900/20 disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none border border-black ">
                                Comment
                            </button>
                        </div>
                    </div>

                </form>
                <button
                    class="commentbutton px-3 py-3 font-sans text-xs font-bold text-center text-gray-900 uppercase align-middle transition-all rounded-lg select-none hover:bg-gray-900/10 active:bg-gray-900/20 disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none border border-black"
                    id="commentbutton{{post.id}}">
                    View {{post.comments|length}} Comments
                </button>
                <div id="comment{{post.id}}" class="hidden ">
                    {% for comment in post.comments %}
                    <div class="flex items-center relative">
                        <p class="inline-flex items-center mr-3 text-gray-900  font-semibold text-md">
                            {{comment.user.username}}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{comment.date_created.strftime('%H:%M, %d
                            %B,%Y')}}
                        </p>
                        {% if user.id == comment.user.id %}
                        <div class="absolute top-1 right-1 cursor-pointer" onclick="delete_comment('{{comment.id}}')">

                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="red" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M3 6l1 12a2 2 0 002 2h12a2 2 0 002-2l1-12M9 6V4a1 1 0 011-1h4a1 1 0 011 1v2">
                                </path>
                            </svg>
                        </div>
                        {% endif %}

                    </div>
                    <p class="text-gray-500 dark:text-gray-400">{{comment.text}}</p>
                    {% endfor %}
                </div>

            </div>

            {% endfor %}
        </div>
    </div>

</section>


{% endblock %}
{% endblock %}